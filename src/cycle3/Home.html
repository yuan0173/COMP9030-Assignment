<!DOCTYPE html>
<html>
  <head>
    <title>HomePage - Indigenous Art Atlas</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <link rel="stylesheet" href="../cycle2/css/base.css">
    <link rel="stylesheet" href="../cycle2/css/layout.css">
    <link rel="stylesheet" href="../cycle2/css/components.css">
    <link rel="stylesheet" href="../cycle2/css/pages.css">
  </head>
  <body>
    <!-- Header will be dynamically generated by header.js -->
    <div id="header-placeholder"></div>

    <main>
      <!-- Hero banner -->
      <section class="hero">
        <div class="container">
          <h1 class="hero__title">Indigenous Art Atlas</h1>
          <p class="hero__subtitle">Explore and preserve indigenous art heritage</p>
        </div>
      </section>

      <!-- Introduction -->
      <section class="container page-section">
        <p>
          This is a website designed to serve as a community-driven database for tracking and sharing indigenous art in various real-world settings, ranging from ancient cave art to contemporary gallery pieces and public installations.
        </p>
      </section>

      <!-- Interactive Map -->
      <section class="container page-section">
        <div id="map" class="map-box"></div>
      </section>

      <!-- Featured Arts -->
      <section class="container page-section">
        <div class="flex-between" style="align-items:center;gap:12px;">
          <h2 style="margin:0;">Featured Arts</h2>
          <a class="btn btn--ghost" href="./featured.php" title="Open server-rendered Featured list">View All Featured</a>
        </div>

        <div id="featuredArtsContainer" class="cards"></div>
      </section>
    </main>

    <!-- Footer -->
    <footer class="footer page-section">
      <div class="container flex-between">
        <div>© IAA</div>
        <nav>
          <a href="/cycle2/Pages/About.html">Introduction</a> ·
          <a href="/cycle2/Pages/Guideline.html">Guidelines</a> ·
          <a href="/cycle2/Pages/ArtsResult.html">Art Listings</a> ·
          <a href="/cycle2/Pages/Contact.html">Contact Us</a> ·
          <a href="/cycle2/Pages/Disclaimer.html">Disclaimers</a>
        </nav>
      </div>
    </footer>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="../cycle2/js/session.js"></script>
    <script src="../cycle2/js/header.js"></script>
    <script>
      // Enhanced home page functionality for cycle3
      (function(){
        // Load featured arts from API
        function loadFeaturedArts() {
          fetch('/api/arts.php')
            .then(function(response) {
              if (!response.ok) {
                throw new Error('API request failed: ' + response.status);
              }
              return response.json();
            })
            .then(function(data) {
              displayFeaturedArts(data.slice(0, 6)); // Show first 6 items
            })
            .catch(function(err) {
              console.error('Failed to load featured arts:', err);
              document.getElementById('featuredArtsContainer').innerHTML =
                '<div class="notice notice--error">Failed to load featured arts.</div>';
            });
        }

        function displayFeaturedArts(arts) {
          const container = document.getElementById('featuredArtsContainer');
          if (!container) return;

          container.innerHTML = arts.map(function(art) {
            const imageUrl = art.image || '../test.jpg';
            const username = art.author_username ? ('@' + art.author_username) : '';
            let role = art.author_role ? String(art.author_role) : '';
            if (role) role = role.charAt(0).toUpperCase() + role.slice(1);
            const meta = (username || role) ? `<div class="card__desc">${[username, role].filter(Boolean).join(' • ')}</div>` : '';
            return `
              <div class="card">
                <div class="card__img">
                  <img src="${imageUrl}" alt="${art.title}" loading="lazy">
                </div>
                <div class="card__body">
                  <h3 class="card__title">
                    <a href="./art_detail.php?id=${art.id}">${art.title}</a>
                  </h3>
                  <p class="card__desc">${art.description}</p>
                  ${meta}
                </div>
              </div>
            `;
          }).join('');
        }

        // Initialize map
        if (window.L) {
          const mapEl = document.getElementById('map');
          if (mapEl) {
            const map = L.map('map', { center: [-33.8688, 151.2093], zoom: 6 });
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
              maxZoom: 19,
              attribution: '&copy; OpenStreetMap contributors'
            }).addTo(map);

            // Load and display art locations
            fetch('/api/arts.php')
              .then(function(response) { return response.json(); })
              .then(function(data) {
                data.forEach(function(art) {
                  if (art.lat && art.lng) {
                    const lat = parseFloat(art.lat);
                    const lng = parseFloat(art.lng);
                    if (!isNaN(lat) && !isNaN(lng)) {
                      L.marker([lat, lng])
                        .bindPopup(`
                          <strong>${art.title}</strong><br>
                          ${art.type} - ${art.period}<br>
                          <a href="./art_detail.php?id=${art.id}">View Details</a>
                        `)
                        .addTo(map);
                    }
                  }
                });
              })
              .catch(function(err) {
                console.error('Failed to load map data:', err);
              });
          }
        }

        // Load content when page loads
        loadFeaturedArts();
      })();
    </script>
  </body>
</html>
